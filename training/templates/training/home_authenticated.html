{% extends 'training/base_training.html' %}

{% load static %}
{% load pipeline %}
{% load common_extras %}

{% block title_prepend %}Training - {% endblock title_prepend %}

{% block meta %}
{% static 'training/images/placeholders/opengraph.jpg' as image_path %}
{% absolute_url image_path as image_url %}
{% with title="Training" description="Learn from our expert team. Courses, workshops and production lessons with .blend files included." %}
{% include 'common/components/meta.html' %}
{% endwith %}
{% endblock %}

{% block jumbotron %}
<div class="jumbotron jumbotron-fluid jumbotron-overlay header">
  <div class="jumbotron-bg-wrapper">
    <img class="jumbotron-bg" src="{% static "training/images/placeholders/jumbotron.jpg" %}">
    <!-- TODO(Mike): Implement image sets when flat-pages are done. -->
    {% comment %}
    {% include "common/components/helpers/image_set.html" with classes="jumbotron-bg" img_source=XXX xsmall_width="576" small_width="758" medium_width="992" large_width="1200" xlarge_width="1920" %}
    {% endcomment %}
  </div>
  <div class="container-xl">
    <div class="row">
      <div class="col-lg-5 col-xl-4">
        <div class="jumbotron-body">
          <h1>Training</h1>
          <p class="mb-0">
            Learn from our expert team. Courses, workshops and production lessons with .blend files included.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock jumbotron %}

{% block content %}
<div class="container-xl pt-3">

  <!-- Recently watched -->
  {% if recently_watched_sections %}
  <section class="mb-4">

    <div class="row justify-content-center mb-2 mb-md-3">
      <div class="col-md">
        <h2 class="mb-0">Continue training</h2>
        <p class="mb-0">Recently watched videos appear here! Continue watching where you left off.</p>
      </div>
      <div class="col-md-auto d-none d-md-block carousel-card-toolbar">
        <a class="btn btn-lg btn-transparent btn-icon {% if recently_watched_sections|length <= 1 %}onlyOne{% elif recently_watched_sections|length <= 4 %} lessThanFour {% endif %}"
          href="#continueTraining" role="button" data-slide="prev">
          <i class="material-icons">arrow_back</i>
        </a>
        <a class="btn btn-lg btn-transparent btn-icon {% if recently_watched_sections|length <= 1 %}onlyOne{% elif recently_watched_sections|length <= 4 %} lessThanFour {% endif %}"
          href="#continueTraining" role="button" data-slide="next">
          <i class="material-icons">arrow_forward</i>
        </a>
      </div>
    </div>

    <div class="row">
      <div id="continueTraining" class="carousel carousel-card-4 slide w-100" data-touch="true" data-ride="carousel"
        data-interval="0">
        <div class="carousel-inner w-100" role="listbox">
          <div class="carousel-item active">
            {% for section in recently_watched_sections|slice:':1' %}
            {% include "training/components/card_section.html" with section=section card_sizes="col-md-3" %}
            {% endfor %}
          </div>
          {% for section in recently_watched_sections|slice:'1:' %}
          <div class="carousel-item">
            {% include "training/components/card_section.html" with section=section card_sizes="col-md-3" %}
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="row d-block d-md-none">
      <div class="col-md-auto carousel-card-toolbar">
        <a class="btn btn-lg btn-transparent btn-icon {% if recently_watched_sections|length <= 1 %}onlyOne{% elif recently_watched_sections|length <= 4 %} lessThanFour {% endif %}"
          href="#continueTraining" role="button" data-slide="prev">
          <i class="material-icons">arrow_back</i>
        </a>
        <a class="btn btn-lg btn-transparent btn-icon {% if recently_watched_sections|length <= 1 %}onlyOne{% elif recently_watched_sections|length <= 4 %} lessThanFour {% endif %}"
          href="#continueTraining" role="button" data-slide="next">
          <i class="material-icons">arrow_forward</i>
        </a>
      </div>
    </div>

  </section>
  {% endif %}

  <section class="mb-4">

    <div class="row justify-content-center mb-2 mb-md-3">
      <div class="col-md">
        <h2 class="mb-0">Your saved training</h2>
        <p class="mb-0">You can add and remove items from this list by clicking the plus or the tick.</p>
      </div>
      <div class="col-md-auto d-none d-md-block carousel-card-toolbar">
        <a class="btn btn-lg btn-transparent btn-icon {% if favorited_trainings|length <= 1 %}onlyOne{% elif favorited_trainings|length <= 3 %} lessThanThree {% endif %}"
          href="#savedTraining" role="button" data-slide="prev">
          <i class="material-icons">arrow_back</i>
        </a>
        <a class="btn btn-lg btn-transparent btn-icon {% if favorited_trainings|length <= 1 %}onlyOne{% elif favorited_trainings|length <= 3 %} lessThanThree {% endif %}"
          href="#savedTraining" role="button" data-slide="next">
          <i class="material-icons">arrow_forward</i>
        </a>
      </div>
    </div>

    <div class="row">
      <div id="savedTraining" class="carousel carousel-card-3 carousel-card-saved slide w-100" data-ride="carousel"
        data-interval="0">
        <div class="carousel-inner w-100" role="listbox">
          {% if favorited_trainings %}
          {% comment %} {% for training in featured_trainings|slice:':1' %}
          {% include "common/components/cards/card_training.html" with training=training card_sizes="col-md-4" %}
          {% endfor %} {% endcomment %}
          {% for training in favorited_trainings|slice:':1' %}
          <div class="carousel-item active">
            {% include "training/components/card_training.html" with training=training card_sizes="col-md-4" %}
          </div>
          {% endfor %}

          {% for training in favorited_trainings|slice:'1:6' %}
          <div class="carousel-item">
            {% include "training/components/card_training.html" with training=training card_sizes="col-md-4" %}
          </div>
          {% endfor %}
          {% else %}
          <div class="col text-center empty-saved-training">
            <div class="bg-secondary py-4 rounded">
              <h3 class="mb-0">No saved training</h3>
              <p class="mb-0">You can favorite a few below!</p>
            </div>
          </div>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="row d-block d-md-none">
      <div class="col-md-auto carousel-card-toolbar">
        <a class="btn btn-lg btn-transparent btn-icon {% if favorited_trainings|length <= 1 %}onlyOne{% elif favorited_trainings|length <= 3 %} lessThanThree {% endif %}"
          href="#savedTraining" role="button" data-slide="prev">
          <i class="material-icons">arrow_back</i>
        </a>
        <a class="btn btn-lg btn-transparent btn-icon {% if favorited_trainings|length <= 1 %}onlyOne{% elif favorited_trainings|length <= 3 %} lessThanThree {% endif %}"
          href="#savedTraining" role="button" data-slide="next">
          <i class="material-icons">arrow_forward</i>
        </a>
      </div>
    </div>
  </section>


  <!-- SEARCH -->

  <section>

    <div class="row">

      <div class="col mb-3">
        <h2 class="mb-0">All Training</h2>
      </div>

      <div class="col-auto mb-3">
        <div class="input-group input-group-sm" id="sorting">
          <div class="input-group-prepend">
            <label class="input-group-text" for="searchLicence">Sort by:</label>
          </div>
        </div>
      </div>

    </div>

    <div id="search" class="row">

      <div class="col-md-6 mb-3">
        <div id="search_input" class="input-group">
          <div class="input-group-prepend">
            <span class="input-group-text">
              <i class="material-icons">search</i>
            </span>
          </div>
        </div>
      </div>

      <div id="search_type" class="col-md-3 col-6 mb-3"></div>

      <div id="search_difficulty" class="col-md-3 col-6 mb-3"></div>

    </div>

    <div class="row" id="hits"></div>

  </section>
</div>

{% endblock content %}

{% block scripts %}
{% javascript 'vendor_instantsearch' %}
{{ favorited_training_ids|json_script:"training-favorited-ids" }}
{{ search_client_config|json_script:"training-search-client-config" }}
{% javascript 'training' %}
{% javascript 'training_search' %}

<script>
  $('.carousel-card-3 .carousel-item').each(function () {
    cardCarousel(this, 3);
  });

  $('.carousel-card-4 .carousel-item').each(function () {
    cardCarousel(this, 4);
  });
</script>
{% endblock scripts %}
