{% extends 'common/base.html' %}
{% load static %}

{% block content %}

<div class="jumbotron jumbotron-fluid jumbotron-overlay overlay-wide-content jumbotron header mb-4">
  <div class="jumbotron-bg-wrapper">
    <img class="jumbotron-bg" src="{% static "common/images/home/settlers-bg.jpg" %}">
    <!-- TODO(Mike): Impliment image sets when flat-pages are done. -->
    {% comment %}
    {% include "common/components/helpers/image_set.html" with classes="jumbotron-bg" img_source=XXX xsmall_width="576" small_width="758" medium_width="992" large_width="1200" xlarge_width="1920" %}
    {% endcomment %}
  </div>
  <div class="container-xl">
    <div class="row">
      <div class="col-lg-5 col-md-6">
        <div class="jumbotron-body">
          <p class="mb-1"><span class="badge badge-primary mr-2">New</span><span class="subtitle">Blog Post</span>
          </p>
          <h1 class="mb-2 em">Blender Cloud v4</h1>
          <p>Welcome to the fresh redesign of Blender Cloud!</p>
          <p class="mb-3">In this new version of the platform we deliver design and interaction improvements that will
            make it easier and more fun to discover all the content created by the Blender Studio team over the years.
          </p>
          <a href="/blog/blender-cloud-v4" class="btn btn-primary">Read the Blog Post</a>
        </div>
      </div>
    </div>
  </div>

</div>

<div class="container-xl">

  <!-- FIXME: exact copy-pasta of the snippet in training/home_authenticated.html: maybe use include? -->
  <!-- Recently watched -->
  {% if recently_watched_sections %}
  <section class="mb-4">

    <div class="row justify-content-center mb-2 mb-md-3">
      <div class="col-md">
        <h2 class="mb-0">Continue training</h2>
        <p class="mb-0">Recently watched videos appear here! Continue watching where you left off.</p>
      </div>
      <div class="col-md-auto d-none d-md-block carousel-card-toolbar">
        <a class="btn btn-lg btn-transparent btn-icon {% if recently_watched_sections|length <= 1 %}onlyOne{% elif recently_watched_sections|length <= 4 %} lessThanFour {% endif %}"
          href="#continueTraining" role="button" data-slide="prev">
          <i class="material-icons">arrow_back</i>
        </a>
        <a class="btn btn-lg btn-transparent btn-icon {% if recently_watched_sections|length <= 1 %}onlyOne{% elif recently_watched_sections|length <= 4 %} lessThanFour {% endif %}"
          href="#continueTraining" role="button" data-slide="next">
          <i class="material-icons">arrow_forward</i>
        </a>
      </div>
    </div>

    <div class="row">
      <div id="continueTraining" class="carousel carousel-card-4 slide w-100" data-touch="true" data-ride="carousel"
        data-interval="0">
        <div class="carousel-inner w-100" role="listbox">
          <div class="carousel-item active">
            {% for section in recently_watched_sections|slice:':1' %}
            {% include "training/components/card_section.html" with section=section card_sizes="col-md-3" %}
            {% endfor %}
          </div>
          {% for section in recently_watched_sections|slice:'1:' %}
          <div class="carousel-item">
            {% include "training/components/card_section.html" with section=section card_sizes="col-md-3" %}
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="row d-block d-md-none">
      <div class="col-md-auto carousel-card-toolbar">
        <a class="btn btn-lg btn-transparent btn-icon {% if recently_watched_sections|length <= 1 %}onlyOne{% elif recently_watched_sections|length <= 4 %} lessThanFour {% endif %}"
          href="#continueTraining" role="button" data-slide="prev">
          <i class="material-icons">arrow_back</i>
        </a>
        <a class="btn btn-lg btn-transparent btn-icon {% if recently_watched_sections|length <= 1 %}onlyOne{% elif recently_watched_sections|length <= 4 %} lessThanFour {% endif %}"
          href="#continueTraining" role="button" data-slide="next">
          <i class="material-icons">arrow_forward</i>
        </a>
      </div>
    </div>

  </section>
  {% endif %}

  <section class="mb-4">

    <div class="row justify-content-center mb-2">
      <div class="col">
        <h2 class="mb-0">Latest Blog Posts</h2>
        <p class="mb-0">Hear the latest news about the Blender Cloud right here.</p>
      </div>
      <div class="col-md-auto d-none d-md-block carousel-card-toolbar">
        <a class="btn btn-lg btn-transparent btn-icon {% if latest_posts|length <= 1 %}onlyOne{% elif latest_posts|length <= 4 %} lessThanFour {% endif %}"
          href="#latestPosts" role="button" data-slide="prev">
          <i class="material-icons">arrow_back</i>
        </a>
        <a class="btn btn-lg btn-transparent btn-icon {% if latest_posts|length <= 1 %}onlyOne{% elif latest_posts|length <= 4 %} lessThanFour {% endif %}"
          href="#latestPosts" role="button" data-slide="next">
          <i class="material-icons">arrow_forward</i>
        </a>
      </div>
    </div>
    <div class="row">
      <div id="latestPosts" class="carousel carousel-card-3 slide w-100" data-touch="true" data-ride="carousel"
        data-interval="0">
        <div class="carousel-inner w-100" role="listbox">
          <div class="carousel-item active">
            {% for post in latest_posts|slice:':1' %}
            {% include 'blog/card_blog.html' %}
            {% endfor %}
          </div>
          {% for post in latest_posts|slice:'1:6' %}
          <div class="carousel-item">
            {% include 'blog/card_blog.html' %}
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="row d-block d-md-none">
      <div class="col-md-auto carousel-card-toolbar">
        <a class="btn btn-lg btn-transparent btn-icon {% if latest_posts|length <= 1 %}onlyOne{% elif latest_posts|length <= 4 %} lessThanFour {% endif %}"
          href="#latestPosts" role="button" data-slide="prev">
          <i class="material-icons">arrow_back</i>
        </a>
        <a class="btn btn-lg btn-transparent btn-icon {% if latest_posts|length <= 1 %}onlyOne{% elif latest_posts|length <= 4 %} lessThanFour {% endif %}"
          href="#latestPosts" role="button" data-slide="next">
          <i class="material-icons">arrow_forward</i>
        </a>
      </div>
    </div>
  </section>

  <section class="mb-4">

    <div class="row justify-content-center mb-2">
      <div class="col-md">
        <h2 class="mb-0">Latest Training</h2>
        <p class="mb-0">Want to see more? <a href="/training">Explore all training</a></p>
      </div>
      <div class="col-md-auto d-none d-md-block carousel-card-toolbar">
        <a class="btn btn-lg btn-transparent btn-icon {% if featured_trainings|length <= 1 %}onlyOne{% elif featured_trainings|length <= 4 %} lessThanThree {% endif %}"
          href="#continueLearning" role="button" data-slide="prev">
          <i class="material-icons">arrow_back</i>
        </a>
        <a class="btn btn-lg btn-transparent btn-icon {% if featured_trainings|length <= 1 %}onlyOne{% elif featured_trainings|length <= 4 %} lessThanThree {% endif %}"
          href="#continueLearning" role="button" data-slide="next">
          <i class="material-icons">arrow_forward</i>
        </a>
      </div>
    </div>

    <div class="row">
      <div id="continueLearning" class="carousel carousel-card-3 slide w-100" data-touch="true" data-ride="carousel"
        data-interval="0">
        <div class="carousel-inner w-100" role="listbox">
          <div class="carousel-item active">
            {% for training in featured_trainings|slice:':1' %}
            {% include "common/components/cards/card_training.html" with training=training card_sizes="col-md-4" %}
            {% endfor %}
          </div>
          {% for training in featured_trainings|slice:'1:6' %}
          <div class="carousel-item">
            {% include "common/components/cards/card_training.html" with training=training card_sizes="col-md-4" %}
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="row d-block d-md-none">
      <div class="col-md-auto carousel-card-toolbar">
        <a class="btn btn-lg btn-transparent btn-icon {% if featured_trainings|length <= 1 %}onlyOne{% elif featured_trainings|length <= 4 %} lessThanFour {% endif %}"
          href="#continueLearning" role="button" data-slide="prev">
          <i class="material-icons">arrow_back</i>
        </a>
        <a class="btn btn-lg btn-transparent btn-icon {% if featured_trainings|length <= 1 %}onlyOne{% elif featured_trainings|length <= 4 %} lessThanFour {% endif %}"
          href="#continueLearning" role="button" data-slide="next">
          <i class="material-icons">arrow_forward</i>
        </a>
      </div>
    </div>
  </section>

  <section class="mb-4">
    <div class="row justify-content-center mb-3">
      <div class="col-md-6 text-center">
        <h2 class="mb-0">Featured Open Movies</h2>
        <p class="mb-0">The Blender <a href="/films">Open Movie projects</a> are made possible by subscriptions to the
          Blender Cloud.</p>
      </div>
    </div>
    <div class="row">
      {% for film in featured_films|slice:':3' %}
      {% include "films/components/card_film.html" with film=film %}
      {% endfor %}
    </div>
  </section>

  <section class="mb-4">
    <div class="row justify-content-center mb-2">
      <div class="col">
        <h2 class="mb-0">From The Archives</h2>
        <p class="mb-0">Explore the depths of the Blender cloud and jump in somewhere random!</p>
      </div>
      <div class="col-md-auto d-none d-md-block carousel-card-toolbar">
        <a class="btn btn-lg btn-transparent btn-icon {% if featured_film_assets|length <= 1 %}onlyOne{% elif featured_film_assets|length <= 4 %} lessThanThree {% endif %}"
          href="#fromTheArchives" role="button" data-slide="prev">
          <i class="material-icons">arrow_back</i>
        </a>
        <a class="btn btn-lg btn-transparent btn-icon {% if featured_film_assets|length <= 1 %}onlyOne{% elif featured_film_assets|length <= 4 %} lessThanThree {% endif %}"
          href="#fromTheArchives" role="button" data-slide="next">
          <i class="material-icons">arrow_forward</i>
        </a>
      </div>
    </div>
    <div class="row">
      <div id="fromTheArchives" class="carousel carousel-card-4 slide w-100" data-touch="true" data-ride="carousel"
        data-interval="0">
        <div class="carousel-inner w-100" role="listbox">
          <div class="carousel-item active">
            {% for asset in featured_film_assets|slice:':1' %}
            {% include "common/components/file_carousel.html" with film_asset=asset card_sizes="col-md-3" %}
            {% comment %}
            {% include "common/components/cards/card_featured_asset.html" with film_asset=asset card_sizes="col-md-3" %}
            {% endcomment %}
            {% endfor %}
          </div>
          {% for asset in featured_film_assets|slice:'1:6' %}
          <div class="carousel-item">
            {% include "common/components/file_carousel.html" with film_asset=asset card_sizes="col-md-3" %}
            {% comment %}
            {% include "common/components/cards/card_featured_asset.html" with film_asset=asset card_sizes="col-md-3" %}
            {% endcomment %}
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="row d-block d-md-none">
      <div class="col-md-auto carousel-card-toolbar">
        <a class="btn btn-lg btn-transparent btn-icon {% if featured_film_assets|length <= 1 %}onlyOne{% elif featured_film_assets|length <= 4 %} lessThanFour {% endif %}"
          href="#fromTheArchives" role="button" data-slide="prev">
          <i class="material-icons">arrow_back</i>
        </a>
        <a class="btn btn-lg btn-transparent btn-icon {% if featured_film_assets|length <= 1 %}onlyOne{% elif featured_film_assets|length <= 4 %} lessThanFour {% endif %}"
          href="#fromTheArchives" role="button" data-slide="next">
          <i class="material-icons">arrow_forward</i>
        </a>
      </div>
    </div>
  </section>

</div>

<script>
  // Humanizes dates
  document.querySelectorAll('.date').forEach(i => {
    i.textContent = timeDifference(epochToDate(i.textContent));
  });
</script>

<script>
  $('.carousel-card-3 .carousel-item').each(function () {
    cardCarousel(this, 3);
  });

  $('.carousel-card-4 .carousel-item').each(function () {
    cardCarousel(this, 4);
  });
</script>

{% endblock content %}
