{% extends 'common/base.html' %}
{% load static %}
{% load common_extras %}

{% block title_append %} - {{ post.title }}{% endblock title_append %}

{% block meta %}
{% with title=post.title description=post.excerpt image_url=post.thumbnail_m_url %}
{% include 'common/components/meta.html' %}
{% endwith %}
{% endblock %}

{% block content %}
<div class="jumbotron jumbotron-fluid jumbotron-blog mb-0">
  <div class="jumbotron-bg-wrapper">
    {% if post.header %}
    {% include "common/components/helpers/image_set.html" with alt=asset.name classes="jumbotron-bg" img_source=post.header xsmall_width="600" small_width="800" medium_width="1000" large_width="1200" xlarge_width="1920" %}
    {% endif %}
  </div>

</div>


<section class="container-blog">

  <div class="row mb-3">
    <div class="col">
      <p class="subtitle">{{ post.date_published|date:"jS M Y" }}{% if post.category %} | {{ post.category }}{% endif %}{% if post.film %} | <a href="{{ post.film.url }}">{{ post.film }}</a>{% endif %}</p>
      <h1 class="display-3 mb-0">{{ post.title|linebreaksbr }}</h1>
    </div>
  </div>
  {% include "blog/blog_toolbar.html" %}

  <div class="markdown-text editorial-text-area mb-4">{% with_shortcodes post.content_html %}</div>

  {% include "blog/blog_toolbar.html" %}

  <section class="my-4">{% include 'comments/components/comment_section.html' %}</section>

</section>

{% endblock %}

{% block scripts %}

<script>
  const videoPlayer = new Plyr(document.querySelector('.video-player video'));

  const loopButton = `
      <button class="plyr__controls__item plyr__control" type="button" data-plyr="loop">
        <svg class="icon--pressed" aria-hidden="true" focusable="false">
          <use xlink:href="#plyr-restart"></use>
        </svg>
        <svg class="icon--not-pressed" aria-hidden="true" focusable="false">
          <svg id="plyr-restart" viewBox="0 0 18 18"><path d="M9.7 1.2l.7 6.4 2.1-2.1c1.9 1.9 1.9 5.1 0 7-.9 1-2.2 1.5-3.5 1.5-1.3 0-2.6-.5-3.5-1.5-1.9-1.9-1.9-5.1 0-7 .6-.6 1.4-1.1 2.3-1.3l-.6-1.9C6 2.6 4.9 3.2 4 4.1 1.3 6.8 1.3 11.2 4 14c1.3 1.3 3.1 2 4.9 2 1.9 0 3.6-.7 4.9-2 2.7-2.7 2.7-7.1 0-9.9L16 1.9l-6.3-.7z" fill-opacity=".5"></path></svg>
        </svg>
        <span class="label--pressed plyr__sr-only">Disable looping</span>
        <span class="label--not-pressed plyr__sr-only">Enable looping</span>
      </button>
      `;

      videoPlayer.elements.container.addEventListener('ready', () => {
        videoPlayer.elements.controls.querySelector('.plyr__menu').insertAdjacentHTML('afterend', loopButton)

        videoPlayer.elements.controls.querySelector('[data-plyr="loop"]').addEventListener('click', event => {
          event.target.classList.toggle("plyr__control--pressed");
          videoPlayer.media.loop = !videoPlayer.media.loop;
        })
      });

</script>

{% endblock scripts %}
